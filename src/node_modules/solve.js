"use strict";

var _ = require("lodash");
var parse = require("parse");
var evalAround = require("eval-around");
var unparse = require("unparse");

module.exports = _.flow(parse, solve, unparse);

function solve(input) {

    var result = [];

    var indexCol = 0;
    var indexRow = 0;
    var best;
    while (indexCol < input.ncols && indexRow < input.nrows) {
        best = evalAround(input, indexRow, indexCol);
        console.error(JSON.stringify(best));

        if (best.right) {
            result.push(best);
            indexCol = parseInt(best.right) + 1;
        }
        else {
            indexCol += 1;

        }

        //retour à la ligne
        if (indexCol >= input.ncols) {
            indexRow = parseInt(best.top || indexRow) + 1;
            indexCol = 0;
        }
        console.error("next is : " + indexRow + " x " + indexCol);
    }

//delete result[result.length];
    console.error(JSON.stringify(result));
    return result;
}
