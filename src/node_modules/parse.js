"use strict";

var _ = require("lodash");

module.exports = parse;

function parse(input) {
  var lines = input.split("\n");
  var map = parseLineOfInts(lines[0], ["ny", "nx", "nz"]);
  var stats = parseLineOfInts(lines[1], ["ntargets", "range", "nloons", "nsteps"]);
  var home = parseLineOfInts(lines[2], ["y", "x"]);
  var targets = _(lines)
    .drop(3)
    .take(stats.ntargets)
    .map(_.partial(parseLineOfInts, _, ["y", "x"]))
    .value();
  var winds = _(lines)
    .drop(3)
    .drop(stats.ntargets)
    .take(map.nz * map.ny)
    .map(parseLineAsVectorsOfInts)
    .chunk(map.ny)
    .value();
  return _.assign({}, map, stats, {home: home, targets: targets, winds: winds});
}

function parseLineOfInts(line, keys) {
  return _.object(keys, _.map(line.split(" "), _.ary(parseInt, 1)));
}

function parseLineAsVectorsOfInts(line) {
  return _(line)
    .split(" ")
    .map(_.ary(parseInt, 1))
    .chunk(2)
    .map(_.partial(_.object, ["y", "x"], _))
    .value();
}
